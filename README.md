# Aina Flutter

Мобильное приложение Aina, разработанное на Flutter для платформ iOS и Android. Приложение предоставляет пользователям возможность взаимодействия с торговыми центрами, коворкингами и другими объектами.

![alt text](@https://is2-ssl.mzstatic.com/image/thumb/PurpleSource211/v4/d6/00/fb/d600fb42-d449-38f0-10a2-2734c9b69343/1290_2796_2.png/0x0ss.png)

![alt text](@https://is2-ssl.mzstatic.com/image/thumb/PurpleSource221/v4/96/ac/bf/96acbfc9-0afe-a973-1edd-5109a347b185/1290_2796_1.png/0x0ss.png)

![alt text](@https://is2-ssl.mzstatic.com/image/thumb/PurpleSource221/v4/fd/e1/2e/fde12e17-da6f-9d46-0981-b48eeb2c079a/1290_2796_3.png/0x0ss.png)

![alt text](@https://is2-ssl.mzstatic.com/image/thumb/PurpleSource211/v4/46/7c/87/467c878b-0e74-da64-a531-63341ba40ff9/1290_2796_4.png/0x0ss.png)

## Основные функции

### 1. Управление профилем
- Редактирование персональной информации
- Управление видимостью профиля
- Загрузка и редактирование фотографий
- Настройка контактной информации

### 2. Коворкинг
- Просмотр доступных рабочих мест
- Бронирование коворкингов
- Управление бронированиями
- История использования

### 3. Торговые центры
- Просмотр информации о ТРЦ
- Акции и специальные предложения
- Навигация по ТРЦ
- Интерактивные карты

### 4. Социальные функции
- Создание и управление карточкой сообщества
- Взаимодействие с другими пользователями
- Обмен контактами
- Социальные мероприятия

## Содержание

- [Обзор проекта](#обзор-проекта)
- [Установка и запуск](#установка-и-запуск)
- [Архитектура проекта](#архитектура-проекта)
  - [FSD методология](#fsd-методология)
  - [Слои (Layers)](#слои-layers)
  - [Слайсы (Slices)](#слайсы-slices)
  - [Сегменты (Segments)](#сегменты-segments)
  - [Правила и ограничения](#правила-и-ограничения)
- [Стек технологий](#стек-технологий)
- [Работа с API](#работа-с-api)
- [Локализация](#локализация)
- [Тестирование](#тестирование)
- [Сборка и деплой](#сборка-и-деплой)
- [Последние изменения](#последние-изменения)

## Обзор проекта

Aina - это мобильное приложение для управления и взаимодействия с торговыми центрами, коворкингами и другими объектами. Приложение предоставляет пользователям возможность просматривать информацию о ТРЦ, бронировать коворкинги, просматривать акции и многое другое.

## Установка и запуск

### Требования

- Flutter SDK 3.0.0 или выше
- Dart 2.17.0 или выше
- Android Studio / VS Code с плагинами Flutter и Dart
- iOS: Xcode 13.0 или выше (для разработки под iOS)
- Android: Android SDK 21 или выше

### Установка зависимостей

```bash
flutter pub get
```

### Запуск приложения

```bash
flutter run
```

## Архитектура проекта

### FSD методология

Проект построен по методологии Feature-Sliced Design (FSD). Основные принципы:

- **Масштабируемость**: архитектура легко масштабируется при росте проекта
- **Изоляция функциональности**: каждая фича изолирована от других
- **Переиспользуемость компонентов**: компоненты легко переиспользуются благодаря четкому разделению
- **Четкое разделение ответственности**: каждый слой имеет свою зону ответственности

### Структура проекта

```
lib/
├── app/                    # Уровень приложения
│   ├── styles/             # Глобальные стили
│   ├── providers/          # Глобальные провайдеры
│   └── assets/             # Ресурсы (изображения, переводы)
│
├── processes/              # Кросс-функциональные процессы
│   ├── community/          # Процессы сообщества
│   └── feedback/           # Процессы обратной связи
│
├── features/               # Функциональные модули
│   ├── coworking/          # Функционал коворкинга
│   │   ├── ui/             # UI компоненты данной фичи
│   │   │   ├── pages/      # Страницы коворкинга
│   │   │   └── widgets/    # Виджеты коворкинга
│   │   ├── model/          # Бизнес-логика данной фичи
│   │   │   ├── models/     # Модели данных
│   │   │   └── providers/  # Провайдеры состояния
│   │   └── api/            # API для данной фичи
│   ├── stores/             # Функционал магазинов и ТРЦ
│   │   └── ...
│   ├── user/               # Функционал пользователя
│   │   └── ...
│   └── home/               # Функционал главной страницы
│       └── ...
│
├── shared/                 # Общие ресурсы
│   ├── api/                # Код для работы с API
│   ├── config/             # Конфигурация
│   ├── models/             # Общие модели
│   ├── navigation/         # Навигация
│   ├── services/           # Общие сервисы
│   ├── types/              # Типы данных
│   ├── utils/              # Вспомогательные функции
│   └── ui/                 # Общие UI компоненты
│       ├── widgets/        # Переиспользуемые виджеты
│       └── blocks/         # Более крупные UI блоки
│
└── main.dart               # Точка входа
```

### Слои

1. **App**: Конфигурации, стили и провайдеры уровня приложения.
2. **Processes**: Кросс-функциональные бизнес-процессы.
3. **Features**: Самодостаточные функциональные модули с собственным UI, логикой и API.
4. **Shared**: Ресурсы, используемые во всем приложении.

### Правила архитектуры

1. **Зависимости между слоями**: Каждый слой может зависеть только от слоев ниже его.
   - App может импортировать processes, features и shared.
   - Processes может импортировать features и shared.
   - Features может импортировать только shared.

2. **Правила перекрестных импортов**:
   - Нельзя делать прямые импорты между фичами.
   - Каждая фича должна быть самодостаточной.
   - Общий код выносится в shared.

3. **Организация файлов**:
   - Группировка по слайсу, затем по слою (feature/ui, feature/model, feature/api).
   - Связанный код должен находиться рядом.
   - Для каждого уровня создаются index.dart файлы для публичного API.

4. **Управление состоянием**:
   - Состояние уровня фичи остается внутри фичи.
   - Глобальное состояние помещается в app/providers.
   - Для управления состоянием используется Riverpod.

5. **Тестирование**:
   - Каждый слой должен быть независимо тестируемым.
   - UI компоненты должны быть отделены от бизнес-логики.

## Стек технологий

- **State Management**: Riverpod
- **Navigation**: Функциональная навигация через shared/navigation
- **HTTP Client**: Dio
- **Локализация**: easy_localization
- **UI компоненты**: Material Design
- **Хранение данных**: SharedPreferences, Hive
- **Аналитика**: Amplitude
- **Push-уведомления**: Firebase Cloud Messaging

## Работа с API

API взаимодействие организовано через слой shared/api:

```dart
// shared/api/client.dart
class ApiClient {
  final Dio dio;
  
  ApiClient() {
    dio = Dio(BaseOptions(
      baseUrl: 'https://api.example.com',
      // ...
    ));
  }
}

// features/user/api/user_api.dart
class UserApi {
  final ApiClient _client;
  
  Future<UserDto> getUser(String id) async {
    final response = await _client.dio.get('/users/$id');
    return UserDto.fromJson(response.data);
  }
}
```

## Локализация

Переводы хранятся в assets/translations и организованы по фичам:

```
assets/translations/
├── ru.json
├── en.json
└── kk.json
```

Использование:
```dart
Text('user.profile.title'.tr())
```

## Тестирование

Тесты организованы по той же структуре, что и код:

```
test/
├── features/
│   └── user/
│       ├── ui/
│       ├── model/
│       └── api/
└── shared/
```

### Типы тестов

1. **Unit Tests**: Тестирование отдельных компонентов и сервисов
2. **Widget Tests**: Тестирование UI компонентов
3. **Integration Tests**: Тестирование взаимодействия между компонентами
4. **E2E Tests**: Тестирование полных пользовательских сценариев

## Сборка и деплой

### Android

```bash
flutter build apk --release
```

### iOS

```bash
flutter build ios --release
```

## Правила и ограничения

### 1. Правила импортов

- Слои могут импортировать только нижележащие слои:
```dart
// Правильно (app -> features)
import 'package:aina_flutter/features/user/ui/user_card.dart';

// Неправильно (features -> app)
import 'package:aina_flutter/app/providers/auth_provider.dart';
```

### 2. Правила сегментов

- UI может импортировать model
- Model не должен импортировать ui

```dart
// features/user/ui/widgets/user_card.dart
import '../../model/models/user.dart';  // Правильно

// features/user/model/providers/user_provider.dart
import '../../ui/widgets/user_card.dart';  // Неправильно!
```

### 3. Правила слайсов

- Слайсы не должны импортировать друг друга напрямую
- Для общения между слайсами используйте shared

### 4. Правила именования

- Файлы: snake_case (user_card.dart)
- Классы: PascalCase (UserCard)
- Переменные и методы: camelCase (getUserData)
- Константы: SCREAMING_SNAKE_CASE (API_URL)

## Последние изменения

### Миграция на FSD архитектуру

Проект успешно переведен на Feature-Sliced Design (FSD) архитектуру со следующими улучшениями:

1. **Реорганизация структуры проекта**:
   - Реорганизована структура каталогов в соответствии с FSD
   - Созданы соответствующие index.dart файлы для экспорта модулей

2. **Стандартизация кода**:
   - Унифицирована работа с моделями данных
   - Перемещены общие модели в shared/models
   - Устранены дублирующиеся классы (ServiceImage, PhoneNumber)

3. **Исправлены проблемы совместимости**:
   - Решены проблемы с амбициозными экспортами
   - Исправлены конфликты с импортами в storybook.dart
   - Унифицирована работа с изображениями сервисов через общую модель

4. **Улучшена структура виджетов**:
   - Созданы index.dart файлы для экспорта виджетов в features/*/ui/widgets
   - Упорядочены импорты в соответствии с FSD архитектурой

Все эти изменения привели к более структурированному, поддерживаемому и масштабируемому коду.

## Поддержка и обратная связь

Для получения поддержки или отправки обратной связи:
1. Создайте issue в репозитории проекта
2. Опишите проблему или предложение
3. Укажите версию приложения и платформу
4. Прикрепите скриншоты или логи, если необходимо

## Лицензия

MIT License
